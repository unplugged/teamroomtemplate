<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE agent SYSTEM 'xmlschemas/domino_8_5_3.dtd'>
<agent name='(wSendLink)' xmlns='http://www.lotus.com/dxl' version='8.5' maintenanceversion='3.0'
 replicaid='80257AC50035BEE2' hide='v3' runaswebuser='true' publicaccess='false'
 designerversion='6' language='en'>
<noteinfo noteid='1a6' unid='3137C6A44E5B3CFA85256825005580D0' sequence='22'>
<created><datetime>19991110T103355,36-05</datetime></created>
<modified><datetime>20121129T094703,36+00</datetime></modified>
<revised><datetime dst='true'>20090617T103847,76-04</datetime></revised>
<lastaccessed><datetime>20121129T094703,36+00</datetime></lastaccessed>
<addedtofile><datetime>20121129T094703,36+00</datetime></addedtofile></noteinfo>
<updatedby><name>CN=Lotus Notes Template Development/O=Lotus Notes</name></updatedby>
<wassignedby><name>CN=Lotus Notes Template Development/O=Lotus Notes</name></wassignedby>
<designchange><datetime dst='true'>20090617T103847,23-04</datetime></designchange>
<trigger type='agentlist'/>
<documentset type='runonce'/><code event='options'><lotusscript>Option Public
Option Declare
Option Compare Nocase
Use "DiscussionRoutines"

</lotusscript></code><code event='initialize'><lotusscript>Sub Initialize
	Dim dbug As New noteslog("wSendLink")	
'logging is for debug purposes
	Set dbug = New NotesLog("wSendLink")
'to turn off the debug log, set this to False     
	dbug.LogActions = True
	dbug.OpenAgentLog	
	
	Dim session As New notessession
	Dim note As notesdocument
	Dim TRname As Variant
	Dim TeamRoomName As String
	Dim Subj As Variant
	Dim peopleList As Variant
	Dim errMsg As String
	Dim lcDocType As Variant
	Dim lcMtg As Variant
	Dim peopleView As notesview
	Dim partdoc As notesdocument
	Dim partAddress As Variant
	Dim DDrtitem As notesrichtextitem
	Dim mailnote As notesdocument
	Dim Sname As String
	Dim goBack As String
	Dim noteUNID As String
	Dim errList As String
	Dim L As Integer
	Dim trimComma  As String
	Dim profiledoc As notesdocument
	Dim dbpath As String
	Dim wMail As String
	
	InstantiateObjects
	
	Set note = session.documentcontext
	Dim webaddress As Variant
	Dim getWebAddress As String
	
	getWebAddress = getURL
	dbpath = getdbpath
	
	If getWebAddress = "" Then
		wMail = getString(15)
	Else
		wMail = "  http://"+ getWebAddress +"/"+ dbpath+"/$All/"+note.universalid
	End If	
	
	Set profiledoc = db.getprofiledocument("tempvars")	
	
	If note.isnewnote Then
		profiledoc.MailSent = getstring(14)
		Exit Sub
	End If	
	
	TRname = note.getitemvalue("TeamRoomName")
	If trName(0) = "" Then
		TeamRoomName = getString(2)
	Else
		TeamRoomName = trName(0)
	End If
	
	subj  = note.getitemvalue("Subject")
	peopleList = note.getitemvalue("People")
	lcDocType = note.getitemvalue("DocType")
	lcMtg = note.getitemvalue("DefaultDocType3")
	
	If subj(0) = "" Then
		subj(0) = getString(1)
	End If
	
	If peopleList(0) = "" And Lcase(lcDocType(0)) = Lcase(lcMtg(0)) Then	
		profiledoc.MailSent = getstring(5)
		Exit Sub
	Elseif peopleList(0) = "" Then
		profiledoc.MailSent = getstring(6)
		Exit Sub
	End If	
	
	Set mailnote = New notesdocument(db)
	
	Forall x In peopleList
		Set DDrtitem = New NotesRichTextItem(mailnote, "Body")
		Set peopleView = db.getview("PeopleLookup")		
		Set partdoc = peopleview.getdocumentbykey(x)
		partAddress = partdoc.getitemvalue("email")
		If partAddress(0) &lt;&gt; "" Then
			x = partAddress(0)
		End If
		
		Sname = x
		mailnote.SendTo = x
		mailnote.subject = subj(0)
		
		Call DDrtitem.appendtext(getString(8))
		Call DDrtitem.addnewline(2)
		Call DDrtitem.appendtext(getString(9) + TeamRoomName )
		Call DDrtitem.addnewline(2)
		Call DDrtitem.appendtext(getString(10)	)
'		Call DDrtitem.appenddoclink(note,"")
		Call DDrtitem.appendtext(wMail)
		On Error Goto ErrorMessage
		Call mailnote.send(False)
	End Forall
	Goto Finish	
	
errorMessage:
	errList = errList + ", " + Sname 
	L = Len(ErrList)
	dbug.logaction("errlist = " + errlist)
	dbug.logaction("length=" + Cstr(L))	
	Resume Next
	
finish:
	If errList &lt;&gt; "" Then
		trimComma = Right(errList, L-2)
		errList = trimComma
		profiledoc.MailSent = "There was an error sending mail to the following people: " + errList + ".  " + getString(13)
	Else
		profileDoc.MailSent = getString(11)	
	End If
	
End Sub
</lotusscript></code><code event='GetString'><lotusscript>Function GetString ( StringType As Integer) As String
	
	Select Case StringType
	Case 1  
		GetString = "[Untitled]"
	Case 2
		getString = "[No team name defined]"
	Case 3
		getString = "Mail has been sent successfully."
	Case 4
		getString = "There was an error sending the email to: "
	Case 5
		getString = "There are no attendees specified."
	Case 6
		getString = "There are no assignees specified"
	Case 7
		getString = "Please review: "
	Case 8
		getSTring = "An item requiring your attention has been posted to a TeamRoom database." + Chr(13) 
	Case 9
		getString = "TeamRoom Name: "
	Case 10
		getString = "Item:  "
	Case 11
		getString =  "Mail notifications have been sent successfully."
	Case 12
		getString = "Error on name(s): "
	Case 13
		getString = "Any/all other mail notifications have been sent."
	Case 14
		getString = "You must click the 'Save only' link before sending mail."
	Case 15
		getString = " [Note:  A URL link to this document was not supplied because the web server address is not specified in TeamRoom setup.]"
	End Select
	
End Function	</lotusscript></code>
<rundata processeddocs='0' exitcode='0'>
<agentmodified><datetime dst='true'>20021022T102623,16-04</datetime></agentmodified></rundata></agent>

